---
import BaseLayout from '../layouts/BaseLayout.astro';

// Get search query from URL
const query = Astro.url.searchParams.get('q') || '';
---

<BaseLayout
  title="Ø§Ù„Ø¨Ø­Ø«"
  titleTi="áˆá‹µáˆ‹á‹­"
  description="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ"
>
  <!-- Page Header -->
  <section class="hero-gradient text-white py-12">
    <div class="container text-center">
      <div class="trilingual-title items-center mb-6">
        <h1 class="ar text-3xl font-bold text-white">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h1>
        <p class="en text-lg text-accent font-medium">Search Results</p>
        <p class="ti text-base text-white/80 font-ethiopic">á‹áŒ½áŠ¢á‰µ áˆá‹µáˆ‹á‹­</p>
      </div>

      <!-- Search Form -->
      <form action="/search" method="GET" class="max-w-2xl mx-auto">
        <div class="relative">
          <input
            type="search"
            name="q"
            value={query}
            placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰... | Search content..."
            class="w-full py-4 px-6 pr-14 bg-white rounded-full border-2 border-transparent focus:border-accent focus:outline-none shadow-md text-text-dark"
            autofocus
          />
          <button
            type="submit"
            class="absolute left-3 top-1/2 -translate-y-1/2 p-2 text-primary hover:text-accent transition-colors"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </button>
        </div>
      </form>
    </div>
  </section>

  <!-- Search Results -->
  <section class="py-12 bg-cream min-h-[50vh]">
    <div class="container">
      {query ? (
        <div class="max-w-4xl mx-auto">
          <p class="text-text-light mb-8 text-center">
            <span>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: </span>
            <span class="font-bold text-primary">"{query}"</span>
          </p>

          <div id="search-results" class="space-y-4">
            <!-- Results will be populated by JavaScript -->
          </div>

          <div id="no-results" class="hidden text-center py-12">
            <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gray-100 flex items-center justify-center">
              <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h2 class="text-xl font-bold text-text-dark mb-2">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</h2>
            <p class="text-text-light mb-1">No results found</p>
            <p class="text-text-light font-ethiopic text-sm">á‹áŒ½áŠ¢á‰µ áŠ£á‹­á‰°áˆ¨áŠ½á‰ áŠ•</p>
          </div>
        </div>
      ) : (
        <div class="text-center py-12">
          <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-primary/10 flex items-center justify-center">
            <svg class="w-10 h-10 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
          <h2 class="text-xl font-bold text-text-dark mb-2">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø«</h2>
          <p class="text-text-light mb-1">Start searching</p>
          <p class="text-text-light font-ethiopic text-sm">áˆá‹µáˆ‹á‹­ áŒ€áˆáˆ©</p>
        </div>
      )}
    </div>
  </section>

  <!-- Quick Links -->
  <section class="py-12 bg-white">
    <div class="container text-center">
      <h2 class="text-xl font-bold text-text-dark mb-6 font-amiri">Ø£Ùˆ ØªØµÙØ­ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h2>
      <div class="flex flex-wrap justify-center gap-4">
        <a href="/books" class="btn btn-outline">Ø§Ù„ÙƒØªØ¨</a>
        <a href="/videos" class="btn btn-outline">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</a>
        <a href="/audio" class="btn btn-outline">Ø§Ù„ØµÙˆØªÙŠØ§Øª</a>
        <a href="/scholars" class="btn btn-outline">Ø³ÙŠØ±Ø© Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡</a>
      </div>
    </div>
  </section>
</BaseLayout>

<script is:inline define:vars={{ query }}>
  // Searchable content database
  const searchableContent = [
    // Books
    { type: 'book', titleAr: 'Ø§Ù„Ø±Ø­ÙŠÙ‚ Ø§Ù„Ù…Ø®ØªÙˆÙ…', titleTi: 'áŠ£áˆáˆ¨áˆ’á‰… áŠ£áˆáˆ˜áŠ½á‰±áˆ', description: 'Ø³ÙŠØ±Ø© Ù†Ø¨ÙˆÙŠØ© Ø´Ø§Ù…Ù„Ø©', url: '/books', category: 'Ø§Ù„Ø³ÙŠØ±Ø©' },
    { type: 'book', titleAr: 'Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©', titleTi: 'áŠ¥á‰°áŠ• áˆ°áˆˆáˆµá‰° áˆ˜áˆ°áˆ¨á‰³á‰µ', description: 'Ø£ØµÙˆÙ„ Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø©', url: '/books', category: 'Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø©' },
    { type: 'book', titleAr: 'Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„ØµØ­ÙŠØ­', titleTi: 'áŠ¥á‰² á‰…áŠ‘á‹• á‹²áŠ•', description: 'Ø£ØµÙˆÙ„ Ø§Ù„Ø¥Ø³Ù„Ø§Ù… ÙˆØ§Ù„Ø¥ÙŠÙ…Ø§Ù†', url: '/books', category: 'Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø©' },
    { type: 'book', titleAr: 'Ø§Ù„Ø¹Ø´Ø± Ø§Ù„Ø£Ø®ÙŠØ± Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù†', titleTi: 'áŠ“á‹­ áˆ˜á‹ˆá‹³áŠ¥á‰³ á‹“áˆ°áˆ­á‰° áŒá‹áŠ¥', description: 'ØªÙØ³ÙŠØ± Ù…ÙŠØ³Ø±', url: '/books', category: 'Ø§Ù„ØªÙØ³ÙŠØ±' },
    { type: 'book', titleAr: 'Ø§Ù„Ø¹Ù…Ø±Ø© ÙˆØ§Ù„Ø­Ø¬', titleTi: 'á‹‘áˆáˆ«áŠ• áˆ“áŒ…áŠ•', description: 'Ø¯Ù„ÙŠÙ„ Ù…Ù†Ø§Ø³Ùƒ Ø§Ù„Ø­Ø¬ ÙˆØ§Ù„Ø¹Ù…Ø±Ø©', url: '/books', category: 'Ø§Ù„ÙÙ‚Ù‡' },

    // Videos - Main scholars
    { type: 'video', titleAr: 'ÙÙ‚Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª', titleTi: 'áŠá‰…áˆ‚ áˆ™á‹“áˆ˜áˆ‹á‰µ', description: 'Ø¯Ø±ÙˆØ³ Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø¨ÙŠØ§Ù† ØµØ§Ù„Ø­', url: '/videos', category: 'ÙÙ‚Ù‡' },
    { type: 'video', titleAr: 'Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ©', titleTi: 'áˆ²áˆ« áŠá‰¥á‹­', description: 'Ø¯Ø±ÙˆØ³ ÙÙŠ Ø³ÙŠØ±Ø© Ø§Ù„Ø±Ø³ÙˆÙ„', url: '/videos', category: 'Ø³ÙŠØ±Ø©' },
    { type: 'video', titleAr: 'Ø§Ù„ØªÙØ³ÙŠØ±', titleTi: 'á‰°ááˆ²áˆ­', description: 'Ø¯Ø±ÙˆØ³ Ø§Ù„Ø´ÙŠØ® Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ù„ÙŠÙ… Ø¥Ø¯Ø±ÙŠØ³', url: '/videos', category: 'ØªÙØ³ÙŠØ±' },
    { type: 'video', titleAr: 'Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø³Ù†Ù‰', titleTi: 'áŠ£áˆµáˆ›áŠ¥ áŠ£áˆ‹áˆ… áŠ£áˆáˆ‘áˆµáŠ“', description: 'Ø´Ø±Ø­ Ø§Ù„Ø´ÙŠØ® Ø¢Ø¯Ù… Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡', url: '/videos', category: 'Ø¹Ù‚ÙŠØ¯Ø©' },
    { type: 'video', titleAr: 'Ø¹Ù…Ø¯Ø© Ø§Ù„Ø£Ø­ÙƒØ§Ù…', titleTi: 'á‹‘áˆá‹°á‰µ áŠ£áˆáˆ•áŠ«áˆ', description: 'Ø¯Ø±ÙˆØ³ Ø§Ù„Ø´ÙŠØ® ØµØ§Ù„Ø­ Ø³Ø¹ÙŠØ¯', url: '/videos', category: 'Ø­Ø¯ÙŠØ«' },

    // Audio
    { type: 'audio', titleAr: 'Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø¥Ø³Ù„Ø§Ù…ÙŠØ©', titleTi: 'áˆ˜á‹°áˆ¨á‰³á‰µ', description: 'Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙˆØ¯Ø±ÙˆØ³ ØµÙˆØªÙŠØ©', url: '/audio', category: 'Ù…Ø­Ø§Ø¶Ø±Ø§Øª' },
    { type: 'audio', titleAr: 'Ø®Ø·Ø¨ Ø§Ù„Ø¬Ù…Ø¹Ø©', titleTi: 'áŠ¹áŒ¥á‰£', description: 'Ø®Ø·Ø¨ Ù…Ø³Ø¬Ù„Ø©', url: '/audio', category: 'Ø®Ø·Ø¨' },

    // Scholars
    { type: 'scholar', titleAr: 'Ø¹Ù„Ù…Ø§Ø¡ Ø¥Ø±ÙŠØªØ±ÙŠØ§', titleTi: 'áˆ˜áˆ»á‹­áŠ½ áŠ¤áˆ­á‰µáˆ«', description: 'ØªØ§Ø±ÙŠØ® ÙˆØ³ÙŠØ± Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡', url: '/scholars', category: 'ØªØ§Ø±ÙŠØ®' },
  ];

  function searchContent(searchQuery) {
    if (!searchQuery || searchQuery.trim() === '') return [];

    const q = searchQuery.toLowerCase().trim();

    return searchableContent.filter(item => {
      return (
        item.titleAr.toLowerCase().includes(q) ||
        item.titleTi.toLowerCase().includes(q) ||
        item.description.toLowerCase().includes(q) ||
        item.category.toLowerCase().includes(q)
      );
    });
  }

  function renderResults(results) {
    const container = document.getElementById('search-results');
    const noResults = document.getElementById('no-results');

    if (!container || !noResults) return;

    if (results.length === 0) {
      container.innerHTML = '';
      noResults.classList.remove('hidden');
      return;
    }

    noResults.classList.add('hidden');

    const typeLabels = {
      book: { ar: 'ÙƒØªØ§Ø¨', icon: 'ğŸ“š' },
      video: { ar: 'ÙÙŠØ¯ÙŠÙˆ', icon: 'ğŸ¬' },
      audio: { ar: 'ØµÙˆØªÙŠ', icon: 'ğŸ§' },
      scholar: { ar: 'Ø³ÙŠØ±Ø©', icon: 'ğŸ‘¤' },
    };

    container.innerHTML = results.map(item => {
      const label = typeLabels[item.type] || { ar: 'Ù…Ø­ØªÙˆÙ‰', icon: 'ğŸ“„' };
      return `
        <a href="${item.url}" class="block card p-4 hover:border-primary border-2 border-transparent transition-all">
          <div class="flex items-start gap-4">
            <span class="text-2xl">${label.icon}</span>
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-1">
                <span class="badge badge-primary text-xs">${label.ar}</span>
                <span class="badge bg-cream text-text-light text-xs">${item.category}</span>
              </div>
              <h3 class="font-bold text-text-dark">${item.titleAr}</h3>
              <p class="text-sm text-text-light font-ethiopic">${item.titleTi}</p>
              <p class="text-sm text-text-light mt-1">${item.description}</p>
            </div>
            <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </div>
        </a>
      `;
    }).join('');
  }

  // Run search on page load if query exists
  if (query) {
    const results = searchContent(query);
    renderResults(results);
  }
</script>

<style>
  .font-ethiopic {
    font-family: var(--font-ethiopic);
  }
  .font-amiri {
    font-family: var(--font-amiri);
  }
</style>
